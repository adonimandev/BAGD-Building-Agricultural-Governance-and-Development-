<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <script src="public/bagd-lang-theme.js"></script>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#0b1b13" />
  <title>BAGD ‚Äî Shopping Cart</title>

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+Ethiopic:wght@400;600;700&display=swap" rel="stylesheet" />

  <style>
    /* ========= Default (Dark Mode) ========= */
    :root {
      --bg: #0b1b13;
      --fg: #ffffff;
      --surface: #16291f;
      --border: rgba(255, 255, 255, 0.15);

      --primary: #36d399;
      --primary-hover: #28a07f;
      --btn-text: #ffffff;

      --input-bg: #1e3327;
      --input-text: #ffffff;
      --placeholder: rgba(255, 255, 255, 0.5);

      --link: #36d399;
      --number: #ffffff;
    }

    /* ========= Light Mode ========= */
    [data-theme="light"] {
      --bg: #f5f5f5;
      --fg: #111111;
      --surface: #ffffff;
      --border: rgba(0, 0, 0, 0.12);

      --primary: #36d399;
      --primary-hover: #28a07f;
      --btn-text: #111111;

      --input-bg: #ffffff;
      --input-text: #111111;
      --placeholder: rgba(0, 0, 0, 0.4);

      --link: #111111;
      --number: #111111;
    }

    * { transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
    body {
      margin: 0;
      font-family: 'Inter', sans-serif;
      background: var(--bg);
      color: var(--fg);
      line-height: 1.5;
      min-height: 100vh;
    }

    .site-header {
      background: var(--surface);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      padding: 12px 20px;
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .container { width: min(1200px, 92%); margin-inline: auto; }
    .header-inner { display:flex; align-items:center; justify-content:space-between; gap:16px; }
    .brand { font-size:1.2rem; font-weight:bold; text-decoration:none; color:var(--fg); display:flex; align-items:center; gap:8px;}
    .glass { background:var(--surface); border:1px solid var(--border); border-radius:12px; padding:14px; backdrop-filter: blur(10px); box-shadow:0 4px 12px rgba(0,0,0,0.05); }
    button, .btn, .icon-btn {
      background: var(--primary);
      color: var(--btn-text);
      border: none;
      border-radius: 8px;
      padding: 8px 14px;
      font-weight: 500;
      cursor: pointer;
      display:inline-flex; align-items:center; gap:8px;
    }
    .btn-secondary { background: transparent; border:1px solid var(--border); color:var(--fg); }
    .btn-outline { background: transparent; border:1px solid var(--primary); color:var(--primary); }

    label { display:flex; flex-direction:column; gap:4px; font-size:0.9rem; color:var(--fg); }
    input, select, textarea { padding:8px 10px; border-radius:8px; border:1px solid var(--border); outline:none; width:100%; background:var(--input-bg); color:var(--input-text); }
    input::placeholder, textarea::placeholder { color:var(--placeholder); }
    input:focus, select:focus, textarea:focus { border-color:var(--primary); box-shadow: 0 0 6px var(--primary); }

    .stat-number, .price, .quantity, .count, .amount { color:var(--number); font-weight:bold; }

    a { color:var(--link); text-decoration:none; transition:opacity 0.3s; }
    a:hover { opacity:0.8; }

    .hero { display:grid; grid-template-columns:1.2fr 0.8fr; gap:24px; align-items:center; padding:40px 0; }
    .hero-text h1 { font-size:clamp(1.8rem,4vw,2.5rem); margin:0 0 16px 0; line-height:1.2; }
    .hero-text p { margin:0 0 24px 0; font-size:1.1rem; opacity:0.8; }
    .hero-cta { display:flex; gap:12px; }

    .hero-stats { display:grid; grid-template-columns: repeat(3,1fr); gap:16px; }
    .stat { padding:16px; border:1px solid var(--border); border-radius:12px; text-align:center; }
    .stat-num { font-size:1.8rem; font-weight:bold; margin-bottom:4px; }
    .stat-label { font-size:0.9rem; opacity:0.8; }

    .filters { margin:24px 0; }
    .filter-grid { display:grid; grid-template-columns: repeat(auto-fit, minmax(200px,1fr)); gap:16px; }
    .content-grid { display:grid; grid-template-columns:350px 1fr; gap:24px; margin:24px 0; }

    .cards { display:grid; grid-template-columns: repeat(auto-fill, minmax(280px,1fr)); gap:20px; }
    .card { border:1px solid var(--border); border-radius:12px; overflow:hidden; background:var(--surface); transition:transform 0.3s ease, box-shadow 0.3s ease; }
    .card:hover { transform:translateY(-5px); box-shadow:0 10px 20px rgba(0,0,0,0.1); }
    .card img { width:100%; height:160px; object-fit:cover; }
    .card-body { padding:16px; }
    .muted { opacity:0.7; font-size:0.9rem; margin:0 0 12px 0; }

    .site-footer { margin-top:60px; padding:30px 0; border-top:1px solid var(--border); }
    .footer-grid { display:flex; justify-content:space-between; align-items:center; }

    .chatbot-icon { position: fixed; bottom: 20px; right: 20px; width: 60px; height: 60px; border-radius: 50%; background: var(--primary); color: var(--btn-text); display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 1000; font-size:1.5rem; }

    .graphs { display:grid; grid-template-columns:1fr 1fr; gap:20px; margin-top:16px; }
    .graph { height:200px; border-radius:12px; background:var(--input-bg); }

    /* Cart specific styles */
    .cart-item { display: flex; gap: 16px; padding: 16px; border-bottom: 1px solid var(--border); }
    .cart-item-image { width: 100px; height: 100px; border-radius: 8px; object-fit: cover; }
    .cart-item-details { flex: 1; }
    .cart-item-title { font-size: 1.1rem; margin: 0 0 8px 0; }
    .cart-item-price { font-weight: bold; color: var(--primary); margin-bottom: 8px; }
    .cart-item-quantity { display: flex; align-items: center; gap: 8px; }
    .quantity-btn { width: 30px; height: 30px; border-radius: 50%; display: flex; align-items: center; justify-content: center; background: var(--input-bg); border: 1px solid var(--border); cursor: pointer; }
    .quantity-input { width: 50px; text-align: center; }
    .cart-item-remove { color: #dc3545; background: none; border: none; cursor: pointer; font-size: 0.9rem; }
    
    .cart-summary { padding: 20px; background: var(--surface); border-radius: 12px; border: 1px solid var(--border); }
    .summary-row { display: flex; justify-content: space-between; margin-bottom: 12px; }
    .summary-total { font-size: 1.2rem; font-weight: bold; border-top: 1px solid var(--border); padding-top: 12px; }
    
    .empty-cart { text-align: center; padding: 40px; }
    .empty-cart-icon { font-size: 3rem; margin-bottom: 16px; }

    @media (max-width:900px) {
      .hero { grid-template-columns:1fr; text-align:center; }
      .content-grid { grid-template-columns:1fr; }
      .hero-stats { grid-template-columns:repeat(3,1fr); }
      .filter-grid { grid-template-columns:1fr 1fr; }
      .header-inner { flex-direction:column; gap:12px; }
      .cart-item { flex-direction: column; text-align: center; }
      .cart-item-image { width: 100%; height: 200px; }
    }
    @media (max-width:600px) {
      .hero-stats { grid-template-columns:1fr; }
      .filter-grid { grid-template-columns:1fr; }
      .graphs { grid-template-columns:1fr; }
      .hero-cta { flex-direction:column; }
    }

    .skip-link { position:absolute; top:-40px; left:0; background:var(--primary); color:var(--btn-text); padding:8px; z-index:1000; transition:top 0.3s; }
    .skip-link:focus { top:0; }

    .price {
      font-weight: bold;
      color: var(--primary);
      margin-bottom: 12px;
      font-size: 1.1rem;
    }

    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <a class="skip-link" href="#main">Skip to content</a>

  <header class="site-header">
    <div class="container header-inner">
      <a href="index.html" class="brand"><span class="brand-mark">‚öú</span><span class="brand-text">BAGD</span></a>

      <nav class="nav" style="display:flex; align-items:center; gap:8px;">
        <a href="index.html" class="btn btn-secondary">Market</a>
        <a href="buyer.html" class="btn btn-secondary">Buyer</a>
        <a href="farmer.html" class="btn btn-secondary">Farmer</a>
        <a href="hauler.html" class="btn btn-secondary">Hauler</a>
        <button id="themeToggle" class="icon-btn" aria-label="Toggle theme">üåô</button>
        <select id="langSelect" aria-label="Language selector" style="margin-left:8px; padding:6px; border-radius:6px; background:var(--input-bg); color:var(--input-text); border:1px solid var(--border);">
          <option value="en">English</option>
          <option value="am">·ä†·àõ·à≠·äõ (Amharic)</option>
          <option value="om">Afaan Oromoo (Oromo)</option>
          <option value="ti">·âµ·åç·à≠·äõ (Tigrinya)</option>
        </select>
      </nav>
    </div>
  </header>

  <main id="main" class="container">
    <section class="hero">
      <div class="hero-text">
        <h1>Your Shopping Cart</h1>
        <p>Review your selected products and proceed to checkout.</p>
        <div class="hero-cta">
          <a href="index.html" class="btn btn-outline">Continue Shopping</a>
          <button class="btn btn-primary" id="checkout-btn">Proceed to Checkout</button>
        </div>
      </div>

      <div class="hero-stats">
        <div class="stat">
          <div class="stat-num" id="cart-count">0</div>
          <div class="stat-label">Items in Cart</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="cart-total">ETB 0</div>
          <div class="stat-label">Total Amount</div>
        </div>
        <div class="stat">
          <div class="stat-num" id="delivery-cost">ETB 0</div>
          <div class="stat-label">Delivery Cost</div>
        </div>
      </div>
    </section>

    <section class="content-grid">
      <div class="cart-items glass">
        <h2>Cart Items</h2>
        <div id="cart-items-container">
          <!-- Cart items will be loaded here -->
          <div class="empty-cart" id="empty-cart">
            <div class="empty-cart-icon">üõí</div>
            <h3>Your cart is empty</h3>
            <p>Add products from the market to see them here</p>
            <a href="index.html" class="btn btn-primary">Browse Products</a>
          </div>
        </div>
      </div>

      <div class="cart-summary">
        <h2>Order Summary</h2>
        <div class="summary-row">
          <span>Subtotal:</span>
          <span id="summary-subtotal">ETB 0</span>
        </div>
        <div class="summary-row">
          <span>Delivery Fee:</span>
          <span id="summary-delivery">ETB 0</span>
        </div>
        <div class="summary-row">
          <span>Tax (15%):</span>
          <span id="summary-tax">ETB 0</span>
        </div>
        <div class="summary-row summary-total">
          <span>Total:</span>
          <span id="summary-total">ETB 0</span>
        </div>
        
        <div style="margin-top: 20px;">
          <label>
            <span>Delivery Address</span>
            <textarea id="delivery-address" placeholder="Enter your delivery address" rows="3"></textarea>
          </label>
          <div style="height: 12px;"></div>
          <label>
            <span>Payment Method</span>
            <select id="payment-method">
              <option value="telebirr">Telebirr</option>
              <option value="bank">Bank Transfer</option>
              <option value="cash">Cash on Delivery</option>
            </select>
          </label>
          <div style="height: 20px;"></div>
          <button class="btn btn-primary" style="width: 100%;" id="checkout-btn-bottom">Proceed to Checkout</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Chat button -->
  <button class="chatbot-icon" aria-label="Open chatbot" id="openChat">üí¨</button>

  <footer class="site-footer">
    <div class="container footer-grid">
      <div>
        <div class="brand">
          <span class="brand-mark">üåæ</span>
          <span class="brand-text">BAGD</span>
        </div>
        <p class="muted">Market access for farmers, fair prices for all.</p>
      </div>
      <div class="footer-nav">
        <a href="#">About</a>
        <a href="#">Contact</a>
        <a href="#">Privacy</a>
        <a href="#">Terms</a>
      </div>
    </div>
  </footer>

  <!-- JavaScript for Cart Functionality -->
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      // Load cart items from localStorage
      loadCartItems();
      
      // Theme toggle functionality
      const themeToggle = document.getElementById('themeToggle');
      const prefersDarkScheme = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)');
      let currentTheme = localStorage.getItem('bagd_theme') || (prefersDarkScheme && prefersDarkScheme.matches ? 'dark' : 'light');

      function applyTheme(theme) {
        document.documentElement.setAttribute('data-theme', theme);
        localStorage.setItem('bagd_theme', theme);
        if (themeToggle) {
          themeToggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';
          themeToggle.setAttribute('aria-label', theme === 'dark' ? 'Switch to light mode' : 'Switch to dark mode');
        }
      }
      applyTheme(currentTheme);

      if (themeToggle) {
        themeToggle.addEventListener('click', function() {
          currentTheme = currentTheme === 'dark' ? 'light' : 'dark';
          applyTheme(currentTheme);
        });
      }
      
      // Checkout button functionality
      document.getElementById('checkout-btn').addEventListener('click', proceedToCheckout);
      document.getElementById('checkout-btn-bottom').addEventListener('click', proceedToCheckout);
    });

    // Function to load cart items
    function loadCartItems() {
      const cartItems = JSON.parse(localStorage.getItem('bagd_cart')) || [];
      const container = document.getElementById('cart-items-container');
      const emptyCart = document.getElementById('empty-cart');
      
      if (cartItems.length === 0) {
        emptyCart.style.display = 'block';
        container.innerHTML = '';
        container.appendChild(emptyCart);
        updateCartSummary([]);
        return;
      }
      
      emptyCart.style.display = 'none';
      container.innerHTML = '';
      
      cartItems.forEach(item => {
        const cartItemElement = createCartItemElement(item);
        container.appendChild(cartItemElement);
      });
      
      updateCartSummary(cartItems);
    }
    
    // Function to create cart item element
    function createCartItemElement(item) {
      const div = document.createElement('div');
      div.className = 'cart-item';
      div.id = `cart-item-${item.id}`;
      
      // Generate gradient background based on crop type
      const gradient = getGradientForCrop(item.crop);
      
      div.innerHTML = `
        <div style="width: 100px; height: 100px; border-radius: 8px; background: ${gradient};"></div>
        <div class="cart-item-details">
          <h3 class="cart-item-title">${item.crop} (${item.variety})</h3>
          <p class="muted">${item.storage_location}</p>
          <div class="cart-item-price">ETB ${item.price} / kg</div>
          <div class="cart-item-quantity">
            <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity - 1})">-</button>
            <input type="number" class="quantity-input" value="${item.quantity}" min="1" onchange="updateQuantityInput(${item.id}, this.value)">
            <button class="quantity-btn" onclick="updateQuantity(${item.id}, ${item.quantity + 1})">+</button>
            <span>kg</span>
          </div>
        </div>
        <div>
          <div class="price">ETB ${(item.price * item.quantity).toFixed(2)}</div>
          <button class="cart-item-remove" onclick="removeFromCart(${item.id})">Remove</button>
        </div>
      `;
      
      return div;
    }
    
    // Function to update cart summary
    function updateCartSummary(cartItems) {
      const subtotal = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
      const deliveryFee = subtotal > 0 ? 150 : 0; // ETB 150 delivery fee
      const tax = subtotal * 0.15; // 15% tax
      const total = subtotal + deliveryFee + tax;
      
      document.getElementById('cart-count').textContent = cartItems.length;
      document.getElementById('cart-total').textContent = `ETB ${subtotal.toFixed(2)}`;
      document.getElementById('delivery-cost').textContent = `ETB ${deliveryFee.toFixed(2)}`;
      
      document.getElementById('summary-subtotal').textContent = `ETB ${subtotal.toFixed(2)}`;
      document.getElementById('summary-delivery').textContent = `ETB ${deliveryFee.toFixed(2)}`;
      document.getElementById('summary-tax').textContent = `ETB ${tax.toFixed(2)}`;
      document.getElementById('summary-total').textContent = `ETB ${total.toFixed(2)}`;
    }
    
    // Function to update quantity
    function updateQuantity(itemId, newQuantity) {
      if (newQuantity < 1) return;
      
      const cartItems = JSON.parse(localStorage.getItem('bagd_cart')) || [];
      const itemIndex = cartItems.findIndex(item => item.id === itemId);
      
      if (itemIndex !== -1) {
        cartItems[itemIndex].quantity = newQuantity;
        
        // Update localStorage
        localStorage.setItem('bagd_cart', JSON.stringify(cartItems));
        
        // Update the specific item in the UI
        const itemElement = document.getElementById(`cart-item-${itemId}`);
        if (itemElement) {
          const priceElement = itemElement.querySelector('.price');
          if (priceElement) {
            priceElement.textContent = `ETB ${(cartItems[itemIndex].price * newQuantity).toFixed(2)}`;
          }
          
          const quantityInput = itemElement.querySelector('.quantity-input');
          if (quantityInput) {
            quantityInput.value = newQuantity;
          }
        }
        
        // Update the summary
        updateCartSummary(cartItems);
      }
    }
    
    // Function to update quantity from input
    function updateQuantityInput(itemId, value) {
      const newQuantity = parseInt(value);
      if (isNaN(newQuantity) || newQuantity < 1) return;
      
      updateQuantity(itemId, newQuantity);
    }
    
    // Function to remove item from cart
    function removeFromCart(itemId) {
      const cartItems = JSON.parse(localStorage.getItem('bagd_cart')) || [];
      const updatedCart = cartItems.filter(item => item.id !== itemId);
      
      localStorage.setItem('bagd_cart', JSON.stringify(updatedCart));
      loadCartItems();
    }
    
    // Function to proceed to checkout
    function proceedToCheckout() {
  const cartItems = JSON.parse(localStorage.getItem('bagd_cart')) || [];
  const address = document.getElementById('delivery-address').value;
  const paymentMethod = document.getElementById('payment-method').value;

  if (cartItems.length === 0) {
    alert('Your cart is empty. Add products before checkout.');
    return;
  }

  if (!address.trim()) {
    alert('Please enter a delivery address.');
    return;
  }

  // Prepare data to send
  const orderData = {
    cartItems: cartItems,
    deliveryAddress: address,
    paymentMethod: paymentMethod,
    subtotal: cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0),
    deliveryFee: cartItems.length > 0 ? 150 : 0,
    tax: cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0) * 0.15,
  };

  // Send to server
  fetch('save_order.php', {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json'
    },
    body: JSON.stringify(orderData)
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert('Order placed successfully!');
      localStorage.removeItem('bagd_cart');
      window.location.href = 'index.html';
    } else {
      alert('Error saving order: ' + data.message);
    }
  })
  .catch(err => {
    console.error(err);
    alert('Something went wrong while placing your order.');
  });
}

    
    // Helper function to generate gradients based on crop type
    function getGradientForCrop(crop) {
      const gradients = {
        'Maize': 'linear-gradient(45deg, #4caf50, #8bc34a)',
        'Teff': 'linear-gradient(45deg, #795548, #9e9e9e)',
        'Wheat': 'linear-gradient(45deg, #ffd54f, #fff176)',
        'Coffee': 'linear-gradient(45deg, #6d4c41, #a1887f)',
        'Barley': 'linear-gradient(45deg, #d7ccc8, #bcaaa4)',
        'Sorghum': 'linear-gradient(45deg, #8d6e63, #bdbdbd)',
        'Chickpea': 'linear-gradient(45deg, #ffb74d, #ffcc80)'
      };
      
      return gradients[crop] || 'linear-gradient(45deg, #36d399, #28a07f)';
    }
  </script>
</body>
</html>